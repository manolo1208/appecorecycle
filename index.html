<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?display=swap&family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900"/>
  <title>EcoCycle - Iniciar Sesión</title>
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>
<body>
  <div class="relative flex size-full min-h-screen flex-col bg-[#131712] dark justify-between group/design-root overflow-x-hidden" style='font-family: Manrope, "Noto Sans", sans-serif;'>
    <div class="flex flex-col items-center px-4 pt-10">
      <h2 class="text-white text-2xl font-bold mb-6">Bienvenido a EcoCycle</h2>
      
      <div class="w-full max-w-[480px] mb-4">
        <label class="flex flex-col w-full">
          <input placeholder="Correo electrónico" id="email" class="form-input flex w-full resize-none overflow-hidden rounded-xl text-white focus:outline-0 border-none bg-[#2d372a] h-14 placeholder:text-[#a5b6a0] p-4 text-base font-normal" type="email" />
        </label>
      </div>

      <div class="w-full max-w-[480px] mb-4">
        <label class="flex flex-col w-full">
          <input placeholder="Contraseña" id="password" class="form-input flex w-full resize-none overflow-hidden rounded-xl text-white focus:outline-0 border-none bg-[#2d372a] h-14 placeholder:text-[#a5b6a0] p-4 text-base font-normal" type="password" />
        </label>
      </div>

      <div class="w-full max-w-[480px] px-4">
        <button id="action-btn" class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 bg-[#53d22c] text-[#131712] text-base font-bold">
          <span>Iniciar Sesión</span>
        </button>
      </div>

      <p id="toggle-mode" class="text-[#a5b6a0] text-sm mt-4 underline cursor-pointer">¿No tienes cuenta? Regístrate</p>
      <p id="message" class="text-sm mt-2 hidden px-4 text-center"></p>
    </div>

    <div class="text-center pb-6">
      <p class="text-[#a5b6a0] text-xs">Conecta, recicla y gana puntos</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyA2t_5x6x4fi0t4efDjk9OG0Gh1g95U6c0",
      authDomain: "appreciclaje-nuevo.firebaseapp.com",
      projectId: "appreciclaje-nuevo",
      storageBucket: "appreciclaje-nuevo.firebasestorage.app",
      messagingSenderId: "1004737179039",
      appId: "1:1004737179039:web:523003623daaced71c61aa"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const actionBtn = document.getElementById('action-btn');
    const toggleMode = document.getElementById('toggle-mode');
    const message = document.getElementById('message');

    let isLogin = true;

    toggleMode.addEventListener('click', () => {
      isLogin = !isLogin;
      actionBtn.textContent = isLogin ? 'Iniciar Sesión' : 'Crear Cuenta';
      toggleMode.textContent = isLogin 
        ? '¿No tienes cuenta? Regístrate' 
        : '¿Ya tienes cuenta? Inicia sesión';
      message.classList.add('hidden');
    });

    actionBtn.addEventListener('click', async () => {
      const emailVal = email.value.trim();
      const passwordVal = password.value.trim();

      if (!emailVal || !passwordVal) {
        message.textContent = 'Por favor, completa todos los campos';
        message.className = 'text-red-400 text-sm mt-2 px-4 text-center';
        message.classList.remove('hidden');
        return;
      }

      try {
        if (isLogin) {
          await signInWithEmailAndPassword(auth, emailVal, passwordVal);
        } else {
          await createUserWithEmailAndPassword(auth, emailVal, passwordVal);
          message.textContent = 'Cuenta creada. Iniciando sesión...';
          message.className = 'text-green-400 text-sm mt-2 px-4 text-center';
          message.classList.remove('hidden');
        }
      } catch (error) {
        message.textContent = error.message;
        message.className = 'text-red-400 text-sm mt-2 px-4 text-center';
        message.classList.remove('hidden');
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.href = 'home.html';
      }
    });
  </script>
</body>
</html>
